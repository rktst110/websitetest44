
<!-- Importing Firebase SDK Starts Here-->
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
 <!-- Importing Firebase SDK Ends Here-->
 
 <!-- Importing JS files for charts of CanvaJs & HighCharts Starts Here-->
<script src="https://cdn.canvasjs.com/canvasjs.min.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/heatmap.js"></script>
<script src="https://code.highcharts.com/modules/treemap.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>
 <!-- Importing JS files for charts of CanvaJs & HighCharts Ends Here-->
 

  <script src="functions/commonFunctions.js"></script>
  <script src="functions/tableSortingFunctons.js"></script>
 <script src="functions/importFiles.js"></script>
 <script src="functions/firebase.js"></script>
 <script src="functions/firebaseFunctions.js"></script>
<script src="functions/indexedDBFunctions.js"></script>

 <div id="importedContent"></div>
 
 <title>Price Spikes</title>
 
 

<style>
body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
  background-color: #555;
  color: white; 
   text-align: center;
  }
  
   
 .column {
  float: left;
  padding: 0.5px;
  height: 550px;
  width: 42%;
  margin-top:10px;
}

.Left {
  width: 31.5%;
  margin-left:1%;
}

.Right {
  width: 31.5%;
  margin-left:1%;
  margin-bottom:15px;
}

.row:after {
  content: "";
  display: table;
  clear: both;
  text-align: center;
}

@media screen and (max-width: 800px) {
  .column {
    width: 98%;
	font-size: 15px;
	margin-left:1%;
	margin-right:1%;
  margin-bottom:12px;
  }
}


.containerClass
 {
  height: 550px;
  width: 100%;
}

</style>
<style> *, *:before, *:after {box-sizing: border-box;}body {font-family: -apple-system, ".SFNSText-Regular", "Helvetica Neue", "Roboto", "Segoe UI", sans-serif;}.toggle {cursor: pointer;display: inline-block;}.toggle-switch {display: inline-block;background: #ccc;border-radius: 16px;width: 58px;height: 32px;position: relative;vertical-align: middle;transition: background 0.25s;}.toggle-switch:before, .toggle-switch:after {content: "";}.toggle-switch:before {display: block;background: linear-gradient(to bottom, #fff 0%, #eee 100%);border-radius: 50%;box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.25);width: 24px;height: 24px;position: absolute;top: 4px;left: 4px;transition: left 0.25s;}.toggle:hover .toggle-switch:before {background: linear-gradient(to bottom, #fff 0%, #fff 100%);box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.5);}.toggle-checkbox:checked + .toggle-switch {background: #56c080;}.toggle-checkbox:checked + .toggle-switch:before {left: 30px;}.toggle-checkbox {position: absolute;visibility: hidden;}.toggle-label {margin-left: 5px;position: relative;top: 2px;} </style>
		


 <label>Month Year:</label>
<select id="monthYear" onchange="getFirestoreData()">
</select>

 <label> | Trading Date:</label>
<select id="tradingDate" onchange="setCommonSelectors()">
</select>


 <label> | Common TimeValues:</label>
<select id="commonTimeValues" onchange="saveSelectedValues();fetchDataForAllSegments()">
</select>

&nbsp; | &nbsp;&nbsp;
<button id="dataRefreshButton" onclick="getFirestoreData('refresh','')">Refresh</button>
&nbsp;&nbsp;<button id="dataRefreshButton" onclick="getFirestoreData('live','')">Live</button>

<hr>

 <label> Indices TimeValues:</label>
<select id="indicesTimeValues" onchange="getIndicesData()">
</select>

 <label>  | Equity TimeValues:</label>
<select id="marketType" onchange="getEquityData()">
<option>FnO</option>
<option>ALL</option>
<option>AllStocksTraded</option>
</select>
<select id="equityTimeValues" onchange="getEquityData()">
</select>

	
 <span class="toggle-label">Show Tables :  </span> <label class="toggle">  <input id="showTablesOnOff" class="toggle-checkbox" type="checkbox" onchange="getEquityData()"> <div class="toggle-switch"></div> </label>   

 <span class="toggle-label"> | Without FnO :  </span> <label class="toggle">  <input id="withoutFnO" class="toggle-checkbox" type="checkbox" onchange="getEquityData()"> <div class="toggle-switch"></div> </label>   

<br>


<!--Content Start From Here-->

<div class="row">
  <div class="column Left" style="background-color:#aaa;">
<div class="spaceBetweenTables">  	<div id="spike5mTableContainer" class="containerClass"></div> </div>
	
  </div>
  <div class="column Right" style="background-color:#bbb;">
<div class="spaceBetweenTables">  	<div id="spike10mTableContainer" class="containerClass"></div> </div>

  </div>
  
  <div class="column Right" style="background-color:#bbb;">
<div class="spaceBetweenTables">  	<div id="spike15mTableContainer" class="containerClass"></div> </div>

  </div>
  
 </div>

<!--Content Ends Here-->



<!--Content Start From Here-->
<div class="row">
  <div class="column left" style="background-color:#aaa;">
  
 <div id="IndicesPerformanceChart" style="min-height: 520px; height: auto;width: 100%;"></div>
   <br>
   </div>
 
</div>

<!--Content Ends From Here-->


<!--Sector wise spikes Content Start From Here-->

<div class="row">
  <div class="column Left" style="background-color:#aaa;">
<div class="spaceBetweenTables">  	<div id="spike5mTableContainer_sectors" class="containerClass"></div> </div>
	
  </div>
  <div class="column Right" style="background-color:#bbb;">
<div class="spaceBetweenTables">  	<div id="spike10mTableContainer_sectors" class="containerClass"></div> </div>

  </div>
  
  <div class="column Right" style="background-color:#bbb;">
<div class="spaceBetweenTables">  	<div id="spike15mTableContainer_sectors" class="containerClass"></div> </div>

  </div>
  
 </div>

<!--Sector wise spikes Content Ends Here-->



<!--Sector stocks Content Start From Here-->
<div class="row">
	<center>
	<button onclick="document.getElementById('tableListSelector').value='FnO';getEquityDataForSectorStocks()">FnO</button>
	<button onclick="document.getElementById('tableListSelector').value='NIFTY_50';getEquityDataForSectorStocks()">Nifty 50</button>
   <button onclick="document.getElementById('tableListSelector').value='NIFTY_BANK';getEquityDataForSectorStocks()">Banks</button>
   <button onclick="document.getElementById('tableListSelector').value='NIFTY_FIN_SERVICE';getEquityDataForSectorStocks()">Finance</button>
   <button onclick="document.getElementById('tableListSelector').value='NIFTY_MIDCAP_150';getEquityDataForSectorStocks()">Midcap</button>
    | List:
	<select id="tableListSelector" aria-labelledby="expiryLbl" onchange="getEquityDataForSectorStocks()"> <option value="FnO">FnO</option> </select>
		
 <span class="toggle-label">| Show Tables :  </span> <label class="toggle">  <input id="showTablesForSectorStocksOnOff" class="toggle-checkbox" type="checkbox" onchange="getEquityDataForSectorStocks()" checked> <div class="toggle-switch"></div> </label>   
</center>	<br>
  
</div>
<!--Sector stocks Content Ends Here-->

<div class="row">
  <div class="column Left" style="background-color:#aaa;">
<div class="spaceBetweenTables">  	<div id="spike5mTableContainer_sectorStocks" class="containerClass"></div> </div>
	
  </div>
  <div class="column Right" style="background-color:#bbb;">
<div class="spaceBetweenTables">  	<div id="spike10mTableContainer_sectorStocks" class="containerClass"></div> </div>

  </div>
  
  <div class="column Right" style="background-color:#bbb;">
<div class="spaceBetweenTables">  	<div id="spike15mTableContainer_sectorStocks" class="containerClass"></div> </div>

  </div>
  
 </div>




<script>
function fetchDataForAllSegments()
{
setIndicesSelectorTimeValues( "syncWithCommonTime" );
setEquitySelectorTimeValues( "syncWithCommonTime" );


}
</script>


<!-- Indices Code Starts Here -->
<script>

function setIndicesSelectorTimeValues( passedValue )
{
	var tradingDate = document.getElementById('tradingDate').value
	var timeValuesArray = firestoreIndexObj[ tradingDate ]['Index']['index_performace']
	var selectElementRef = document.getElementById("indicesTimeValues");
	//var selectElementRef = document.getElementById("equityTimeValues");
	
	handleTimeValues( passedValue, timeValuesArray, selectElementRef, getIndicesData )
}

async function getIndicesData( passedValue )
{
	var selectedMonthYear = document.getElementById('monthYear').value
	var selectedTradingDate = document.getElementById('tradingDate').value
	var selectedIndicesTimeValues = document.getElementById('indicesTimeValues').value
	//var selectedIndicesTimeValues = document.getElementById('equityTimeValues').value
	
	var docPath = '/'+selectedMonthYear+'/'+selectedTradingDate+'/index_performace/'+selectedIndicesTimeValues
	//await fetchFirebaseDocData( docPath, showIndicesPerformanceChart )
	var dataObj = await fetchFirebaseDocData( docPath )
	//console.log( "dataObj", JSON.parse( dataObj['data'] )  )
	//if( document.getElementById('indicesWith20DAVOnOff').checked==false && document.getElementById('indicesWithOI20DAVOnOff').checked==false && document.getElementById('indicesWithMoneyOnOff').checked==false )
	{
		showIndicesPerformanceChart ( JSON.parse( dataObj['data'] ) )
	}
}

async function showIndicesPerformanceChart ( returnedDataObj, indicesData )
{
	var selectedIndicesTimeValues = document.getElementById('indicesTimeValues').value
	//var selectedValue = document.getElementById("indices_performance_time").value;
		
	//var indicesPerformanceObject = mainOIDataObject['index_performace'][selectedValue]
	var indicesPerformanceObject = returnedDataObj ['data']
	
	// list updated on June 30, 2023 from https://archives.nseindia.com/content/indices/ind_nifty50.pdf
	var sectorsWeightageInNifty50 = { "FIN SERVICE":37.59, "IT":12.65, "OIL AND GAS":11.99, "FMCG": 9.82, "AUTO":5.98, "PHARMA":3.86, "HEALTHCARE":3.86,"Construction":3.54, "METAL":3.52, "CONSR DURBL":3.30,"Telecommunication":2.61, "ENERGY":2.10,"INFRA":1.89, "SERV SECTOR":0.74, "Chemicals":0.41 }
	
	var dataPointsArray=[]
	var dataPointsArrayAdvances=[]
	var dataPointsArrayDeclines=[]
	var dataPointsArrayUnchanged=[]
	var dataPointsArrayPChangeAddition=[]
	
	var tempObj={}
	for (var symbol in indicesPerformanceObject) {
		//if(symbol !='INDIA VIX' && symbol !='NIFTY FINSRV25 50' && symbol !='NIFTY HEALTHCARE' )
		//if(symbol !='INDIA VIX' && symbol !='NIFTY FINSRV25 50' )
		if(symbol !='INDIA VIX' && symbol !='NIFTY FINSRV25 50' && symbol !='NIFTY NEXT 50' && symbol !='NIFTY 100' && symbol !='NIFTY 200' && symbol !='NIFTY 500' && symbol !='NIFTY MIDCAP 50' && symbol !='NIFTY MIDCAP 100' && symbol !='NIFTY SMLCAP 100' && symbol !='NIFTY MIDCAP 150' && symbol !='NIFTY SMLCAP 50' && symbol !='NIFTY SMLCAP 250' && symbol !='NIFTY MIDSML 400' && symbol !='NIFTY500 MULTICAP' && symbol !='NIFTY LARGEMID250' && symbol !='NIFTY TOTAL MKT' && symbol !='NIFTY MICROCAP250' )
		{
			/*
			if( document.getElementById('indicesWith20DAVOnOff').checked==true || document.getElementById('indicesWithOI20DAVOnOff').checked==true || document.getElementById('indicesWithMoneyOnOff').checked==true )
			{
				tempObj[symbol]= Math.abs( indicesPerformanceObject[symbol]['percentChange'] )
			}
			else
			*/
			{
				tempObj[symbol]=indicesPerformanceObject[symbol]['percentChange']
			}			
		
		}
	}
	
// tempObj is sorted by this code
//Object.keys(tempObj).sort((a,b) => tempObj[a]-tempObj[b]).forEach((symbol) => { 	// ascending sort
Object.keys(tempObj).sort((a,b) => tempObj[a]-tempObj[b]).forEach((symbol) => {  	//  descending sort
var temp={}
if(symbol !='NIFTY 50' && symbol !='NIFTY BANK')
//if(symbol !='NIFTY BANK')
{
	temp["label"]=symbol.replace(/NIFTY /g,'')
}
else{
	temp["label"]=symbol
}
	
	if( sectorsWeightageInNifty50[ temp["label"] ]!=undefined )
	{
		 temp["label"] =  temp["label"] +" ("+ sectorsWeightageInNifty50[ temp["label"] ] +")"
	}
	
		//temp["y"]=tempObj[symbol]; 
		temp["y"]= Math.abs( tempObj[symbol] ); 
		var pChange;
		pChange = Number( tempObj[symbol] )
		/*
		if( document.getElementById('indicesWith20DAVOnOff').checked==true || document.getElementById('indicesWithOI20DAVOnOff').checked==true || document.getElementById('indicesWithMoneyOnOff').checked==true )
		{
			pChange = Number( indicesData[symbol]['percentChange'] )
		}
		*/
			
		if(pChange<0) 
		{
			temp["color"]="#cd5652"
		}
		else if(pChange>0) 
		{
			temp["color"]="#3a7dd4"
		}
		else if(pChange==0) 
		{
			temp["color"]="#3a7dd4"
		}
		
		dataPointsArray.push(temp)
	});
	
/*
Object.keys(tempObj).sort((a,b) => tempObj[b]-tempObj[a]).forEach((symbol) => {  	//  descending sort
var temp={}
var sectorName = symbol.replace(/_/g,' ')
if(sectorName !='NIFTY 50' && sectorName !='NIFTY BANK')
//if(symbol !='NIFTY BANK')
{
	temp["label"]=sectorName.replace(/NIFTY /g,'')
}
else{
	temp["label"]=sectorName
}
	
		temp["y"]=indicesPerformanceObject[symbol][9]; 
		temp["color"]="#089981"
			
		dataPointsArrayAdvances.push(temp)
		//console.log(symbol, preMarketSectorObj[symbol]["advances"])
	});
	
Object.keys(tempObj).sort((a,b) => tempObj[b]-tempObj[a]).forEach((symbol) => {  	//  descending sort
var temp={}
var sectorName = symbol.replace(/_/g,' ')
if(sectorName !='NIFTY 50' && sectorName !='NIFTY BANK')
//if(symbol !='NIFTY BANK')
{
	temp["label"]=sectorName.replace(/NIFTY /g,'')
}
else{
	temp["label"]=sectorName
}
	
		temp["y"]=indicesPerformanceObject[symbol][10]; 
		temp["color"]="#cd5652"
		
	
		
		dataPointsArrayDeclines.push(temp)
		
	});	
	
Object.keys(tempObj).sort((a,b) => tempObj[b]-tempObj[a]).forEach((symbol) => {  	//  descending sort
var temp={}
var sectorName = symbol.replace(/_/g,' ')
if(sectorName !='NIFTY 50' && sectorName !='NIFTY BANK')
//if(symbol !='NIFTY BANK')
{
	temp["label"]=sectorName.replace(/NIFTY /g,'')
}
else{
	temp["label"]=sectorName
}
	
		temp["y"]=indicesPerformanceObject[symbol][11]; 
	
		temp["color"]="#cbba4d"
		
		
		dataPointsArrayUnchanged.push(temp)
	});
	
	*/
// this section is for plotting indices chart for simple perchange change of single column bar
var chart = new CanvasJS.Chart("IndicesPerformanceChart", {
	animationEnabled: true,
	theme: "dark2", // "light1", "light2", "dark1", "dark2"
	title: {
		//text: "GDP Growth Rate - 2016"
	},
	subtitles: [{
			//text: "Subtitle 1"
		  },{
			text:  'NSE Sectors | '+returnedDataObj['timestamp'].split(' ')[0] +' | '+ selectedIndicesTimeValues +' | '+returnedDataObj['timestamp'].split(' ')[1],
			//verticalAlign: "top",

			 //horizontalAlign: "right",
	
			 //fontSize: 15,
			 fontSize: 13,
			//dockInsidePlotArea: true
			dockInsidePlotArea: false
	}],
	
	toolTip: {
			//fontSize: 19,
			fontSize: 15,
	},
	axisY: {
		//title: "Growth Rate (in %)",
		//includeZero: true,
		//suffix: "%",
		gridThickness: 0.03,
		//labelFontSize: 18,
		labelFontSize: 0, // bottom size for change%
		 tickLength: 0,
		 
	},
	axisX: {
		interval: 1,
		//title: "Countries"
		includeZero: true,
		 //labelFontSize: 17,
		 labelFontSize: 11, // vertical axis size for text
		 //labelFontWeight: "bold",
		  lineThickness: 0.5,
         lineColor: "#ccc",
		 tickColor: "#555",
		 tickLength: 0,
		
		 
	},
	dataPointWidth: 12,
	data: [{
		//indexLabel: "{y}",
		//indexLabelFontSize: 18,
		click: onClick,
		//type: "column",
		type: "bar",
		indexLabelPlacement: "auto",
			indexLabel: "{y}",
			indexLabelFontSize: 11,
			indexLabelFontColor: "#ddd",
		yValueFormatString: "#,##0.0#\"%\"",
		dataPoints:dataPointsArray
	}]
});


//console.log("dataPointsArray",dataPointsArray)
chart.render();
//chart2.render();

} // showIndicesPerformanceChart ENDS HERE




function onClick(e) {

		//var label=e.dataPoint.label
		var label=e.dataPoint.label.replace(/ \(.*/g, '')
		var labelToScroll;
		{
			if( label=='NIFTY 50' || label=='NIFTY BANK')
			{
				labelToScroll = label.replace(/ /g, '_')
				document.getElementById("heatMapSectorSelector").value = labelToScroll ;
				showHeatMapChart();
				document.getElementById("heatMapSectorSelector").scrollIntoView();
				
				document.getElementById("tableListSelector").value = labelToScroll ;
				getSpurtsEquityData();
				document.getElementById("tableListSelector").scrollIntoView();
			}
			else
			{
				labelToScroll = 'NIFTY_'+label.replace(/ /g, '_')
				document.getElementById("heatMapSectorSelector").value = labelToScroll ;
				showHeatMapChart();
				document.getElementById("heatMapSectorSelector").scrollIntoView();
				
				document.getElementById("tableListSelector").value = labelToScroll ;
				getSpurtsEquityData();
				document.getElementById("tableListSelector").scrollIntoView();
			}
		}

		
}


</script>
<!-- Indices Code Ends Here -->


<!-- Indices Code Starts Here -->
<script>
var sectorStockNamesObj;
function setEquitySelectorTimeValues( passedValue )
{
	var tradingDate = document.getElementById('tradingDate').value
	var selectedMarketTypeValue = document.getElementById('marketType').value
	
	var timeValuesArray = firestoreIndexObj[ tradingDate ]['Index']['equity_market'][selectedMarketTypeValue]
	var selectElementRef = document.getElementById("equityTimeValues");
	
	handleTimeValues( passedValue, timeValuesArray, selectElementRef, getEquityData )
}

async function getEquityData()
{
	var selectedMonthYear = document.getElementById('monthYear').value
	var selectedTradingDate = document.getElementById('tradingDate').value
	var selectedTimeValueRef = document.getElementById('equityTimeValues')
	var selectedMarketTypeValue = document.getElementById('marketType').value
	
	var selectedTimeValue = selectedTimeValueRef.value
		
	var collectioPath = '/'+selectedMonthYear+'/'+selectedTradingDate+'/sector_stockNames/'
	sectorStockNamesObj = await fetchSectorStockNamesCollectionData( collectioPath )
	
	var docPathForDeliveryData = '/'+selectedMonthYear+'/'+selectedTradingDate+'/delivery_data/delivery_data'
	var deliveryDataObj = await fetchDeliveryDataDocData( docPathForDeliveryData )
	
	
	var docPathForEquity = '/'+selectedMonthYear+'/'+selectedTradingDate+'/equity_market/'+selectedMarketTypeValue+'/'+selectedTimeValue+'/'+selectedTimeValue
	var equityDataObj = JSON.parse( (await fetchFirebaseDocData( docPathForEquity ) ) ['data'] )

	var collectioPath = '/'+selectedMonthYear+'/'+selectedTradingDate+'/'
	var calculatedEODDeliveryDataObj = await fetchCalculatedEODDeliveryData( collectioPath )
	
	
	var docPathForSpurts = '/'+selectedMonthYear+'/'+selectedTradingDate+'/spurts_in_open_interest_by_underlyings/'+selectedTimeValue
	var spurtsDataObj = JSON.parse( ( await fetchFirebaseDocData( docPathForSpurts ) ) ['data'] )
	var spurtsDataObj = spurtsDataObj.data.reduce((acc, item) => {  acc[item.symbol] = item;  return acc;}, {});

	console.log( 'spurtsDataObj', spurtsDataObj )
	
	var timeValuePrev5minutes = ''
	var equityDataObjPrev5m = {}
	if( selectedTimeValueRef.options[selectedTimeValueRef.selectedIndex - 3] !=undefined )
	{
	var tableContainerID = 'spike5mTableContainer'
	var tableID = 'spike5mTable'
	var tableCaption = '5 Minutes Spike'
	timeValuePrev5minutes = selectedTimeValueRef.options[selectedTimeValueRef.selectedIndex - 3].value
		var docPathForEquityPrev5m = '/'+selectedMonthYear+'/'+selectedTradingDate+'/equity_market/'+selectedMarketTypeValue+'/'+timeValuePrev5minutes+'/'+timeValuePrev5minutes
	
	equityDataObjPrev5m =  JSON.parse( (await fetchFirebaseDocData( docPathForEquityPrev5m ) ) ['data'] )
		//console.log( "equityDataObj", equityDataObj)
		//console.log( "equityDataObjPrev5m", equityDataObjPrev5m)
		
	
	var docPathForSpurtsPrev5m = '/'+selectedMonthYear+'/'+selectedTradingDate+'/spurts_in_open_interest_by_underlyings/'+timeValuePrev5minutes
	var spurtsDataObjPrev5m = JSON.parse( ( await fetchFirebaseDocData( docPathForSpurtsPrev5m ) ) ['data'] )
	var spurtsDataObjPrev5m = spurtsDataObjPrev5m.data.reduce((acc, item) => {  acc[item.symbol] = item;  return acc;}, {});

	console.log( 'spurtsDataObjPrev5m', spurtsDataObjPrev5m )
		
	show_momentum_spike_Data( tableCaption, tableContainerID, tableID, selectedTimeValue, timeValuePrev5minutes, equityDataObj, equityDataObjPrev5m, JSON.parse( deliveryDataObj['data'] ), selectedTradingDate, calculatedEODDeliveryDataObj, spurtsDataObj, spurtsDataObjPrev5m )
	
	var tableContainerID = 'spike5mTableContainer_sectors'
	var tableID = 'spike5mTable_sectors'
	var tableCaption = '5 Minutes Spike'
	show_sector_momentum_spike_Data( tableCaption, tableContainerID, tableID, selectedTimeValue, timeValuePrev5minutes, equityDataObj, equityDataObjPrev5m, JSON.parse( deliveryDataObj['data'] ), selectedTradingDate)
	//show_sector_stocks_momentum_spike_Data( tableCaption, tableContainerID, tableID, selectedTimeValue, timeValuePrev5minutes, equityDataObj, equityDataObjPrev5m, JSON.parse( deliveryDataObj['data'] ), selectedTradingDate)
	
	}
	
	var timeValuePrev10minutes = ''
	var equityDataObjPrev10m = {}
	if( selectedTimeValueRef.options[selectedTimeValueRef.selectedIndex - 5] !=undefined )
		{
		var tableContainerID = 'spike10mTableContainer'
		var tableID = 'spike10mTable'
		var tableCaption = '10 Minutes Spike'
		timeValuePrev10minutes = selectedTimeValueRef.options[selectedTimeValueRef.selectedIndex - 5].value
		var docPathForEquityPrev10m = '/'+selectedMonthYear+'/'+selectedTradingDate+'/equity_market/'+selectedMarketTypeValue+'/'+timeValuePrev10minutes+'/'+timeValuePrev10minutes

		equityDataObjPrev10m =  JSON.parse(  ( await fetchFirebaseDocData( docPathForEquityPrev10m ) )['data'] )
		
		
		var docPathForSpurtsPrev10m = '/'+selectedMonthYear+'/'+selectedTradingDate+'/spurts_in_open_interest_by_underlyings/'+timeValuePrev10minutes
		var spurtsDataObjPrev10m = JSON.parse( ( await fetchFirebaseDocData( docPathForSpurtsPrev10m ) ) ['data'] )
		var spurtsDataObjPrev10m = spurtsDataObjPrev10m.data.reduce((acc, item) => {  acc[item.symbol] = item;  return acc;}, {});
		console.log( 'spurtsDataObjPrev10m', spurtsDataObjPrev10m )
			
		show_momentum_spike_Data( tableCaption, tableContainerID, tableID, selectedTimeValue, timeValuePrev10minutes, equityDataObj, equityDataObjPrev10m, JSON.parse( deliveryDataObj['data'] ), selectedTradingDate, calculatedEODDeliveryDataObj, spurtsDataObj, spurtsDataObjPrev10m )
		
		var tableContainerID = 'spike10mTableContainer_sectors'
		var tableID = 'spike10mTable_sectors'
		
		show_sector_momentum_spike_Data( tableCaption, tableContainerID, tableID, selectedTimeValue, timeValuePrev10minutes, equityDataObj, equityDataObjPrev10m, JSON.parse( deliveryDataObj['data'] ), selectedTradingDate)
		}


	var timeValuePrev15minutes = ''
	var equityDataObjPrev15m = {}
	if( selectedTimeValueRef.options[selectedTimeValueRef.selectedIndex - 8] !=undefined )
	{
	var tableContainerID = 'spike15mTableContainer'
	var tableID = 'spike15mTable'
	var tableCaption = '15 Minutes Spike'
	timeValuePrev15minutes = selectedTimeValueRef.options[selectedTimeValueRef.selectedIndex - 8].value
	//timeValuePrev15minutes = selectedTimeValueRef.options[selectedTimeValueRef.selectedIndex - 15].value
	//var index_of_9_15_time = 
	//timeValuePrev15minutes = selectedTimeValueRef.options[ 2 ].value
	//timeValuePrev15minutes = selectedTimeValueRef.options [ 8 ].value
		var docPathForEquityPrev15m = '/'+selectedMonthYear+'/'+selectedTradingDate+'/equity_market/'+selectedMarketTypeValue+'/'+timeValuePrev15minutes+'/'+timeValuePrev15minutes
	
	equityDataObjPrev15m = JSON.parse( (await fetchFirebaseDocData( docPathForEquityPrev15m ) ) ['data'] )
	//equityDataObjPrev15m = JSON.parse( await fetchFirebaseDocData( docPathForEquityPrev15m ) )['data'] 
	
	
	var docPathForSpurtsPrev15m = '/'+selectedMonthYear+'/'+selectedTradingDate+'/spurts_in_open_interest_by_underlyings/'+timeValuePrev15minutes
	var spurtsDataObjPrev15m = JSON.parse( ( await fetchFirebaseDocData( docPathForSpurtsPrev15m ) ) ['data'] )
	var spurtsDataObjPrev15m = spurtsDataObjPrev15m.data.reduce((acc, item) => {  acc[item.symbol] = item;  return acc;}, {});
	console.log( 'spurtsDataObjPrev15m', spurtsDataObjPrev15m )
		
	
	show_momentum_spike_Data( tableCaption, tableContainerID, tableID, selectedTimeValue, timeValuePrev15minutes, equityDataObj, equityDataObjPrev15m, JSON.parse( deliveryDataObj['data'] ), selectedTradingDate, calculatedEODDeliveryDataObj, spurtsDataObj, spurtsDataObjPrev15m )
	
	var tableContainerID = 'spike15mTableContainer_sectors'
	var tableID = 'spike15mTable_sectors'
	show_sector_momentum_spike_Data( tableCaption, tableContainerID, tableID, selectedTimeValue, timeValuePrev15minutes, equityDataObj, equityDataObjPrev15m, JSON.parse( deliveryDataObj['data'] ), selectedTradingDate)
	}
		
	//addEventListnerInTables()

	add_Sectors_In_HeatMapSelector()
	//getEquityDataForSectorStocks()
	
}


async function show_momentum_spike_Data( tableCaption, tableContainerID, tableID, currentTimeValue, previousTimeValue, currentEquityDataObj, previousEquityDataObj, deliveryDataObj, selectedTradingDate, calculatedEODDeliveryDataObj, currentSpurtsDataObj, previousSpurtsDataObj )
//async function show_momentum_spike_Data( selectedSpurtsTimeValue, selectedSpurtsTimeValuePrevious, selectedTradingDate, equityDataObj, equityDataObjPrevious, spurtsDataObj, spurtsDataObjPrevious, deliveryDataObj )
{
	 document.getElementById(tableContainerID).innerHTML = "";
	console.log("deliveryDataObj",deliveryDataObj)

	var niftyTotalMarketObject = currentEquityDataObj['data']
	var niftyTotalMarket2MinutePreviousObject = previousEquityDataObj['data']
	//console.log(niftyTotalMarketObject,niftyTotalMarket2MinutePreviousObject)

	var tempDataObj = {}
	  var onlyEquityTableStr = ' <div class=""> <div class="spaceBetweenTablesSpurtsEquity" style="height:550px;"> <table id="'+tableID+'"> <caption style="caption-side:top"> '+tableCaption+' | '+selectedTradingDate+' | '+previousTimeValue+'-'+currentTimeValue+'</caption> <thead> <tr class="tableRowClass">'
	  +'<th>Symbol</th>'
	  +' <th>Chg%</th>'
	  
	  
	  +' <th>OIC%</th>'
	  +' <th>OI*C%</th>'
	  +' <th>OIChg</th>'
	  +' <th>OIChg%</th>'
	  +' <th>TOTOIChg%</th>'
	  
	  
	  +' <th>DChg%</th>'
	  +' <th>DC%Fac</th>'
	  +' <th>20DAP</th>'
	  +' <th>20DAR</th>'
	  +' <th>O=H</th>'
	  +' <th>O=L</th>'
	 //  +' <th>T.O.</th>'
	   
	   +' <th>P.Spike</th>'
	   +' <th>Fac</th>'
	   +' <th>High</th>'
	   +' <th>Low</th>'
	   
	   +' <th>P.Spike</th>'
	   +' <th>V.Spike</th>'
	   +' <th>PV.Spike</th>'
	   
	 //+' <th>Money</th>'
	  +' <th>20DAV</th>'
	  //+' <th>20DAV_Spike</th>'
	  
	  +' <th>DQ</th>'
	  +' <th>D%</th>'
	  +' <th>Rng</th>'
	  +' </tr> </thead> <tbody>'

		//for (var S=0; S<spurtsInOIUnderlyingsObject.length ;S++ ) { // loop for accessing all stocks of 754 stocks
		//var Symbol=spurtsInOIUnderlyingsObject[S]['symbol']
		for (var Symbol in niftyTotalMarketObject ) { // loop for accessing all stocks of 754 stocks
		var Symbol_temp = Symbol
		Symbol = Symbol.replace(/_.*/g,'')
		
		if( Symbol.includes('NIFTY')==false && Symbol !='NIFTY TOTAL MARKET' && deliveryDataObj["Symbols"][Symbol]!=undefined )
		{
		
		//var symbolArray = niftyTotalMarketObject[Symbol] //for short-handing
		var symbolArray = niftyTotalMarketObject[Symbol_temp] //for short-handing
		//var previousSymbolArray = niftyTotalMarket2MinutePreviousObject [Symbol]  
		var previousSymbolArray = niftyTotalMarket2MinutePreviousObject [Symbol_temp]  
		if( symbolArray !=undefined && previousSymbolArray !=undefined )
		{
		//console.log(Symbol)
	   var valueSpike = Math.abs ( ( ( symbolArray['totalTradedValue'] -  previousSymbolArray['totalTradedValue']) / previousSymbolArray['totalTradedValue'] ) * 100).toFixed(2)
	   var priceSpike =  ( ( ( symbolArray['lastPrice'] -  previousSymbolArray['lastPrice']) / previousSymbolArray['lastPrice'] ) * 100).toFixed(2)
	   var priceValueSpike = Math.abs( valueSpike * priceSpike ).toFixed(2)
	   //var valueSpike = Math.abs(  priceSpike ).toFixed(2)
	
	 var DayOpen = symbolArray['open'] 
	 var DayHigh = symbolArray['dayHigh'] 
	 var DayLow = symbolArray['dayLow'] 
	 var LastPrice = symbolArray['lastPrice'] 
	
	 var DayOpen_previousEntry = previousSymbolArray['open'] 
	 var DayHigh_previousEntry = previousSymbolArray['dayHigh'] 
	 var DayLow_previousEntry = previousSymbolArray['dayLow'] 
	 var LastPrice_previousEntry = previousSymbolArray['lastPrice'] 
	
	var DayChangePercentage =( ( (LastPrice - DayOpen) / DayOpen) *100).toFixed(2)
	
	var open_near_high_percentage =( ( (DayHigh - DayOpen) / DayOpen) *100).toFixed(2)
	var open_near_low_percentage =( ( (DayLow - DayOpen) / DayOpen) *100).toFixed(2)
	  
	  var DayRange =( ( (DayHigh - DayLow) / DayLow) *100).toFixed(2)
	  
    var near_high_pct = (1 - (DayHigh - LastPrice) / (DayHigh - DayLow)) * 100 
    var near_low_pct = (1 - (LastPrice - DayLow) / (DayHigh - DayLow)) * 100
	  
	var average20DaysValue = deliveryDataObj["Symbols"][Symbol]["calculatedData"]["averageValues"]["twentyDays"]

	var twentyDAV =( symbolArray["totalTradedValue"]  / average20DaysValue).toFixed(2)
	//var twentyDAV =( symbolArray["totalTradedValue"]*10000000  / average20DaysValue).toFixed(2)
	
	var twentyDAV_previous =( previousSymbolArray["totalTradedValue"]  / average20DaysValue).toFixed(2)
	var twentyDAV_Spike =  ( ( ( twentyDAV -  twentyDAV_previous) / twentyDAV_previous ) * 100).toFixed(2)
	
	
	 		  tempDataObj[Symbol] ={
			 // "spike":valueSpike,
			  "spike":Math.abs ( priceSpike ),
			  //"spike":Math.abs ( priceValueSpike ),
			  "twentyDAV":twentyDAV,
			  //"pChange":symbolArray['pChange'],
			  //"pChange":priceSpike,
			  "pChange":priceValueSpike,
			  //symbolArray
			  }

		var twentyDAP = 0
		var twentyDA_Range = 0
		if ( deliveryDataObj["Symbols"][Symbol]["calculatedData"]["averagePerChngs"] !=undefined )
		{
			twentyDAP = ( DayChangePercentage / deliveryDataObj["Symbols"][Symbol]["calculatedData"]["averagePerChngs"]["twentyDays"] ).toFixed(2)
			twentyDA_Range = ( DayRange / deliveryDataObj["Symbols"][Symbol]["calculatedData"]["averageDayRanges"]["twentyDays"] ).toFixed(2)
		}
			  
		//if(  	( priceSpike >0 && LastPrice_previousEntry >DayOpen_previousEntry ) ||  ( priceSpike <0 && LastPrice_previousEntry < DayOpen_previousEntry ) 	 ) 
		
		{
			onlyEquityTableStr +='<tr class="item"><td>'
			 +Symbol
			 +'</td><td>'
			+ symbolArray['pChange']  //pchange
			
			 //+'</td><td>'
			// +( symbolArray['totalTradedValue'] / 1000000).toFixed(0)  //(symbolArray[8] / 10000000).toFixed(2) //totalTradedValue
			//+'</td><td>'
			 //+ valueSpike //NoMinuspChng.toFixed(2) 
			// + valueSpike //NoMinuspChng.toFixed(2) 
			 //+ priceValueSpike //NoMinuspChng.toFixed(2) 
			 
			 +'</td><td>'  // currentSpurtsDataObj, previousSpurtsDataObj 
			//+ ( currentSpurtsDataObj[Symbol] && previousSpurtsDataObj[Symbol]  ?( ( (  Math.abs( currentSpurtsDataObj[Symbol]["avgInOI"] ) -  Math.abs( previousSpurtsDataObj[Symbol]["avgInOI"] )  ) / Math.abs( previousSpurtsDataObj[Symbol]["avgInOI"] ) ) * 100).toFixed(2)  : 0 )
			+ ( currentSpurtsDataObj[Symbol] && previousSpurtsDataObj[Symbol]  ?( ( (  Math.abs( currentSpurtsDataObj[Symbol]["latestOI"] ) -  Math.abs( previousSpurtsDataObj[Symbol]["latestOI"] )  ) / Math.abs( previousSpurtsDataObj[Symbol]["latestOI"] ) ) * 100).toFixed(2)  : 0 )
			//+ ( currentSpurtsDataObj[Symbol] && previousSpurtsDataObj[Symbol]  ? Math.abs( ( ( (  Math.abs( currentSpurtsDataObj[Symbol]["latestOI"] ) -  Math.abs( previousSpurtsDataObj[Symbol]["latestOI"] )  ) / Math.abs( previousSpurtsDataObj[Symbol]["latestOI"] ) ) * 100) *  Math.abs ( priceSpike ) ).toFixed(2)  : 0 )
			//+ ( currentSpurtsDataObj[Symbol] && previousSpurtsDataObj[Symbol]  ? ( ( (  Math.abs( currentSpurtsDataObj[Symbol]["avgInOI"] ) -  Math.abs( previousSpurtsDataObj[Symbol]["avgInOI"] )  )  ) ).toFixed(2)   : 0 )
		 
			 +'</td><td>'  // currentSpurtsDataObj, previousSpurtsDataObj 
			//+ ( currentSpurtsDataObj[Symbol] && previousSpurtsDataObj[Symbol]  ? ( ( (  Math.abs( currentSpurtsDataObj[Symbol]["avgInOI"] ) * DayChangePercentage   )  ) ).toFixed(2)   : 0 )
			+ ( currentSpurtsDataObj[Symbol] && previousSpurtsDataObj[Symbol]  ? ( ( (  ( currentSpurtsDataObj[Symbol]["avgInOI"] ) * Math.abs( DayChangePercentage )   )  ) ).toFixed(2)   : 0 )
		 
			 +'</td><td>'  // currentSpurtsDataObj, previousSpurtsDataObj 
			+ ( currentSpurtsDataObj[Symbol] && previousSpurtsDataObj[Symbol]  ? ( ( (  Math.abs( currentSpurtsDataObj[Symbol]["changeInOI"] )   )  ) ).toFixed(2)   : 0 )
			
			+'</td><td>'  // currentSpurtsDataObj, previousSpurtsDataObj 
			//+ ( currentSpurtsDataObj[Symbol] && previousSpurtsDataObj[Symbol]  ?( ( (  Math.abs( currentSpurtsDataObj[Symbol]["avgInOI"] ) -  Math.abs( previousSpurtsDataObj[Symbol]["avgInOI"] )  ) / Math.abs( previousSpurtsDataObj[Symbol]["avgInOI"] ) ) * 100).toFixed(2)  : 0 )
			//+ ( currentSpurtsDataObj[Symbol]  && previousSpurtsDataObj[Symbol] && previousSpurtsDataObj[Symbol]["changeInOI"]>0  ?( ( (  Math.abs( currentSpurtsDataObj[Symbol]["changeInOI"] ) -  Math.abs( previousSpurtsDataObj[Symbol]["changeInOI"] )  ) / Math.abs( previousSpurtsDataObj[Symbol]["changeInOI"] ) ) * 100).toFixed(2)  : 0 )
			+ ( currentSpurtsDataObj[Symbol]  && previousSpurtsDataObj[Symbol] && previousSpurtsDataObj[Symbol]["changeInOI"]>0  ?( ( (  Math.abs( currentSpurtsDataObj[Symbol]["changeInOI"] )  ) / Math.abs( previousSpurtsDataObj[Symbol]["prevOI"] ) ) * 100).toFixed(2)  : 0 )
			//+ ( currentSpurtsDataObj[Symbol] && previousSpurtsDataObj[Symbol]  ? ( ( (  Math.abs( currentSpurtsDataObj[Symbol]["avgInOI"] ) -  Math.abs( previousSpurtsDataObj[Symbol]["avgInOI"] )  )  ) ).toFixed(2)   : 0 )
		 
			 +'</td><td>'  // currentSpurtsDataObj, previousSpurtsDataObj 
			//+ ( currentSpurtsDataObj[Symbol] && previousSpurtsDataObj[Symbol]  ?( ( (  Math.abs( currentSpurtsDataObj[Symbol]["avgInOI"] ) -  Math.abs( previousSpurtsDataObj[Symbol]["avgInOI"] )  ) / Math.abs( previousSpurtsDataObj[Symbol]["avgInOI"] ) ) * 100).toFixed(2)  : 0 )
			+ ( currentSpurtsDataObj[Symbol] && previousSpurtsDataObj[Symbol]  ?( ( (  Math.abs( currentSpurtsDataObj[Symbol]["total"] ) -  Math.abs( previousSpurtsDataObj[Symbol]["total"] )  ) / Math.abs( previousSpurtsDataObj[Symbol]["total"] ) ) * 100).toFixed(2)  : 0 )
			//+ ( currentSpurtsDataObj[Symbol] && previousSpurtsDataObj[Symbol]  ? Math.abs( ( ( (  Math.abs( currentSpurtsDataObj[Symbol]["latestOI"] ) -  Math.abs( previousSpurtsDataObj[Symbol]["latestOI"] )  ) / Math.abs( previousSpurtsDataObj[Symbol]["latestOI"] ) ) * 100) *  Math.abs ( priceSpike ) ).toFixed(2)  : 0 )
			//+ ( currentSpurtsDataObj[Symbol] && previousSpurtsDataObj[Symbol]  ? ( ( (  Math.abs( currentSpurtsDataObj[Symbol]["avgInOI"] ) -  Math.abs( previousSpurtsDataObj[Symbol]["avgInOI"] )  )  ) ).toFixed(2)   : 0 )
		 
			 +'</td><td>'
			+ DayChangePercentage
			
			 +'</td><td>'
			+ Math.abs( twentyDAV * DayChangePercentage ).toFixed(2)
			
			
			 +'</td><td>'
			+ Math.abs( twentyDAP ).toFixed(2)
			
			 +'</td><td>'
			+ Math.abs( twentyDA_Range ).toFixed(2)
			
			 +'</td><td>'
			+ Math.abs( open_near_high_percentage ).toFixed(2)
			
			 +'</td><td>'
			+ Math.abs( open_near_low_percentage ).toFixed(2)
			
			 +'</td><td>'
			+ Math.abs ( priceSpike )
			
			 +'</td><td>'
			+ Math.abs( twentyDAV * priceSpike).toFixed(2)
			//+ Math.abs( DayRange * twentyDAV).toFixed(2)
			
			 +'</td><td>'
			+ near_high_pct.toFixed(0) 
			
			 +'</td><td>'
			+ near_low_pct.toFixed(0) 
			 
			 +'</td><td>'
			+ priceSpike
			
			 +'</td><td>'
			+ valueSpike
			
			 +'</td><td>'
			+ priceValueSpike
			 
			 +'</td><td>'
			// + WFactor
			//+'</td><td>'
			+ twentyDAV
			
			 //+'</td><td>'
			//+ twentyDAV_Spike
			
			//+ Math.abs( twentyDAV * symbolArray['pChange'] ).toFixed(2)
			//+ Math.abs( twentyDAV * priceSpike ).toFixed(2)
			
			+'</td><td>'
			+ (calculatedEODDeliveryDataObj[Symbol] ? calculatedEODDeliveryDataObj[Symbol] ['averageDeliveryQuantity'] : 0)
			+'</td><td>'
			+ (calculatedEODDeliveryDataObj[Symbol] ? calculatedEODDeliveryDataObj[Symbol] ['averageDeliveryPercentage'] : 0)
			+'</td><td>'
			+DayRange
			
			+'</td></tr>'
			
		
		}
		
		
		}
	}
		} //for Loop ENDS HERE
		
		onlyEquityTableStr +=' </tbody> </table>    </div>  </div>'
		
		
if( document.getElementById('showTablesOnOff').checked==true )
{ 
	document.getElementById(tableContainerID).innerHTML = onlyEquityTableStr
}
else
{
showSpikeChart( tableCaption, tableContainerID, tableID, currentTimeValue, previousTimeValue, selectedTradingDate, tempDataObj  )
}
	addEventListnerInTables()
}	//	show_volume_value_spike_Data() Function ENDS HERE

async function show_sector_momentum_spike_Data( tableCaption, tableContainerID, tableID, currentTimeValue, previousTimeValue, currentEquityDataObj, previousEquityDataObj, deliveryDataObj, selectedTradingDate  )
//async function show_momentum_spike_Data( selectedSpurtsTimeValue, selectedSpurtsTimeValuePrevious, selectedTradingDate, equityDataObj, equityDataObjPrevious, spurtsDataObj, spurtsDataObjPrevious, deliveryDataObj )
{
	// document.getElementById(tableContainerID).innerHTML = "";
	

	var niftyTotalMarketObject = currentEquityDataObj['data']
	var niftyTotalMarket2MinutePreviousObject = previousEquityDataObj['data']
	//console.log(niftyTotalMarketObject,niftyTotalMarket2MinutePreviousObject)

	var tempDataObj = {}
	
	for( var sector in sectorStockNamesObj )
	{
		var valueSpike =0
		var positive_price_spikes = 0
		var negative_price_spikes = 0
		//if( sector=='NIFTY_MID_SELECT' || sector=='NIFTY_50' || sector=='NIFTY_AUTO' || sector=='NIFTY_BANK' || sector=='NIFTY_CONSR_DURBL' || sector=='NIFTY_ENERGY' || sector=='NIFTY_FIN_SERVICE' || sector=='NIFTY_FMCG' || sector=='NIFTY_HEALTHCARE' || sector=='NIFTY_INFRA' || sector=='NIFTY_IT' || sector=='NIFTY_MEDIA' || sector=='NIFTY_METAL' || sector=='NIFTY_OIL_AND_GAS' || sector=='NIFTY_PHARMA' || sector=='NIFTY_PSE' || sector=='NIFTY_PSU_BANK' || sector=='NIFTY_PVT_BANK' || sector=='NIFTY_REALTY' || sector=='NIFTY_SERV_SECTOR' )
		//if( sector=='FnO' || sector=='NIFTY_50' || sector=='NIFTY_MID_SELECT' || sector=='NIFTY_AUTO' || sector=='NIFTY_BANK' || sector=='NIFTY_CONSR_DURBL' || sector=='NIFTY_ENERGY' || sector=='NIFTY_FIN_SERVICE' || sector=='NIFTY_FMCG' || sector=='NIFTY_HEALTHCARE' || sector=='NIFTY_IT' || sector=='NIFTY_MEDIA' || sector=='NIFTY_METAL' || sector=='NIFTY_OIL_AND_GAS' || sector=='NIFTY_PHARMA' || sector=='NIFTY_PSE' || sector=='NIFTY_PSU_BANK' || sector=='NIFTY_PVT_BANK' || sector=='NIFTY_REALTY' || sector=='NIFTY_CORE_HOUSING' || sector=='NIFTY_CONSUMPTION'  )
		if( sector=='NIFTY_50' || sector=='NIFTY_MID_SELECT' || sector=='NIFTY_AUTO' || sector=='NIFTY_BANK' || sector=='NIFTY_CONSR_DURBL' || sector=='NIFTY_ENERGY' || sector=='NIFTY_FIN_SERVICE' || sector=='NIFTY_FMCG' || sector=='NIFTY_HEALTHCARE' || sector=='NIFTY_IT' || sector=='NIFTY_MEDIA' || sector=='NIFTY_METAL' || sector=='NIFTY_OIL_AND_GAS' || sector=='NIFTY_PHARMA'  || sector=='NIFTY_PSU_BANK' || sector=='NIFTY_PVT_BANK' || sector=='NIFTY_REALTY'  )
		//if(   sector=='NIFTY_AUTO' || sector=='NIFTY_BANK' || sector=='NIFTY_CONSR_DURBL' || sector=='NIFTY_ENERGY' || sector=='NIFTY_FIN_SERVICE' || sector=='NIFTY_FMCG' || sector=='NIFTY_HEALTHCARE' || sector=='NIFTY_IT' || sector=='NIFTY_MEDIA' || sector=='NIFTY_METAL' || sector=='NIFTY_OIL_AND_GAS' || sector=='NIFTY_PHARMA' || sector=='NIFTY_PSE' || sector=='NIFTY_PSU_BANK' || sector=='NIFTY_PVT_BANK' || sector=='NIFTY_REALTY'  )
		//if( sector=='NIFTY_MID_SELECT' || sector=='NIFTY_AUTO' || sector=='NIFTY_BANK' || sector=='NIFTY_CONSR_DURBL' || sector=='NIFTY_ENERGY' || sector=='NIFTY_FIN_SERVICE' || sector=='NIFTY_FMCG' || sector=='NIFTY_HEALTHCARE' || sector=='NIFTY_IT' || sector=='NIFTY_MEDIA' || sector=='NIFTY_METAL' || sector=='NIFTY_OIL_AND_GAS' || sector=='NIFTY_PHARMA' || sector=='NIFTY_PSE' || sector=='NIFTY_PSU_BANK' || sector=='NIFTY_PVT_BANK' || sector=='NIFTY_REALTY' || sector=='NIFTY_CORE_HOUSING' || sector=='NIFTY_CONSUMPTION' || sector=='NIFTY_COMMODITIES' || sector=='NIFTY_CPSE' || sector=='NIFTY_HIGH_BETA_50' || sector=='NIFTY_HOUSING' || sector=='NIFTY_INDIA_DEFENCE' || sector=='NIFTY_INDIA_MFG'   || sector=='NIFTY_IND_DIGITAL'   || sector=='NIFTY_MOBILITY'   || sector=='NIFTY_PSE'   || sector=='NIFTY_SERV_SECTOR'    || sector=='NIFTY_TRANSPORTATION_AND_LOGISTICS'    || sector==''  )
	
		{
		for (var Symbol of sectorStockNamesObj[ sector ] ) 
		{ // loop for accessing all stocks of 754 stocks
		
		if( deliveryDataObj["Symbols"][Symbol]!=undefined )
		{
		
		var symbolArray = niftyTotalMarketObject[Symbol] //for short-handing
		var previousSymbolArray = niftyTotalMarket2MinutePreviousObject [Symbol]  
		if( symbolArray !=undefined && previousSymbolArray !=undefined )
		{
			var price_spike = ( ( ( symbolArray['lastPrice'] -  previousSymbolArray['lastPrice']) / previousSymbolArray['lastPrice'] ) * 100)
			//valueSpike = Number(valueSpike) + ( ( ( symbolArray['totalTradedValue'] -  previousSymbolArray['totalTradedValue']) / previousSymbolArray['totalTradedValue'] ) * 100)
			//valueSpike = Number(valueSpike) + Math.abs( ( ( symbolArray['lastPrice'] -  previousSymbolArray['lastPrice']) / previousSymbolArray['lastPrice'] ) * 100)
			valueSpike = Number(valueSpike) + price_spike
			var average20DaysValue = deliveryDataObj["Symbols"][Symbol]["calculatedData"]["averageValues"]["twentyDays"]
			var twentyDAV =( symbolArray["totalTradedValue"]  / average20DaysValue).toFixed(2)
	 		
			if( price_spike>=0 )
			{
				positive_price_spikes++
			}
			else
			{
				negative_price_spikes++
			}

			  
		
		}
	}
		} //for Loop ENDS HERE
		
		
			tempDataObj[sector] ={
			  "spike":valueSpike.toFixed(2),
			  //"pChange":symbolArray['pChange']
			  //"pChange":1
			  "pChange":valueSpike,
			  positive_price_spikes,
			  negative_price_spikes,
			  }
		}
	}
	//console.log( 'tempDataObj', tempDataObj )
	
	/*
	
	  var onlyEquityTableStr = ' <div class=""> <div class="spaceBetweenTablesSpurtsEquity" style="height:550px;"> <table id="'+tableID+'"> <caption style="caption-side:top"> '+tableCaption+' | '+selectedTradingDate+' | '+previousTimeValue+'-'+currentTimeValue+'</caption> <thead> <tr class="tableRowClass">'
	  +'<th>Symbol</th>'
	  +' <th>Chg%</th>'
	   +' <th>T.O.</th>'
	   +' <th>Spike</th>'
	 //+' <th>Money</th>'
	  +' <th>20DAV</th>'
	  +' </tr> </thead> <tbody>'

		//for (var S=0; S<spurtsInOIUnderlyingsObject.length ;S++ ) { // loop for accessing all stocks of 754 stocks
		//var Symbol=spurtsInOIUnderlyingsObject[S]['symbol']
		for (var Symbol in niftyTotalMarketObject ) { // loop for accessing all stocks of 754 stocks
		if( Symbol.includes('NIFTY')==false && Symbol !='NIFTY TOTAL MARKET' && deliveryDataObj["Symbols"][Symbol]!=undefined )
		{
		
		var symbolArray = niftyTotalMarketObject[Symbol] //for short-handing
		var previousSymbolArray = niftyTotalMarket2MinutePreviousObject [Symbol]  
		if( symbolArray !=undefined && previousSymbolArray !=undefined )
		{
	   var valueSpike = ( ( ( symbolArray['totalTradedValue'] -  previousSymbolArray['totalTradedValue']) / previousSymbolArray['totalTradedValue'] ) * 100).toFixed(2)
	
	var average20DaysValue = deliveryDataObj["Symbols"][Symbol]["calculatedData"]["averageValues"]["twentyDays"]

	var twentyDAV =( symbolArray["totalTradedValue"]  / average20DaysValue).toFixed(2)
	 		  tempDataObj[Symbol] ={
			  "spike":valueSpike,
			  "pChange":symbolArray['pChange']
			  }

			  
		{
			onlyEquityTableStr +='<tr class="item"><td>'
			 +Symbol
			 +'</td><td>'
			+ symbolArray['pChange']  //pchange
			 +'</td><td>'
			 +( symbolArray['totalTradedValue'] / 1000000).toFixed(0)  //(symbolArray[8] / 10000000).toFixed(2) //totalTradedValue
			+'</td><td>'
			 + valueSpike //NoMinuspChng.toFixed(2) 
			 +'</td><td>'
			// + WFactor
			//+'</td><td>'
			+ twentyDAV
			+'</td></tr>'
			
		
		}
		}
	}
		} //for Loop ENDS HERE
		
		onlyEquityTableStr +=' </tbody> </table>    </div>  </div>'
		
		
if( document.getElementById('showTablesOnOff').checked==true )
{ 
	document.getElementById(tableContainerID).innerHTML = onlyEquityTableStr
}
else
{
showSpikeChart( tableCaption, tableContainerID, tableID, currentTimeValue, previousTimeValue, selectedTradingDate, tempDataObj  )
}
	
	*/
	showSpikeChart( tableCaption, tableContainerID, tableID, currentTimeValue, previousTimeValue, selectedTradingDate, tempDataObj  )
}	//	show_volume_value_spike_Data() Function ENDS HERE

async function showSpikeChart ( tableCaption, tableContainerID, tableID, currentTimeValue, previousTimeValue, selectedTradingDate, returnedDataObj  )
{
	var indicesPerformanceObject = returnedDataObj
		console.log("indicesPerformanceObject",indicesPerformanceObject)
	var dataPointsArray=[]

	var tempObj={}
	for (var symbol in indicesPerformanceObject) {
		
		if( document.getElementById('withoutFnO').checked==true )
		{
			if( sectorStockNamesObj['FnO'].includes(symbol) == false )
			{
				tempObj[symbol]=returnedDataObj[symbol]["spike"]
				//tempObj[symbol]=returnedDataObj[symbol]["twentyDAV"]
			}
			
		}
		else
		{
			tempObj[symbol]=returnedDataObj[symbol]["spike"]
			//tempObj[symbol]=returnedDataObj[symbol]["twentyDAV"]
		}
		
		
	}
	
// tempObj is sorted by this code
//Object.keys(tempObj).sort((a,b) => tempObj[a]-tempObj[b]).forEach((symbol) => { 	// ascending sort
//console.log( Object.keys(tempObj).sort((a,b) => tempObj[b]-tempObj[a]).slice(0, 20).reverse() )
//Object.keys(tempObj).sort((a,b) => tempObj[a]-tempObj[b]).slice(0, 15).forEach((symbol) => {  	//  descending sort

 /*
 //Object.keys(tempObj).sort((a,b) => tempObj[b]-tempObj[a]).slice(0, 18).reverse().forEach((symbol) => {  	//  descending sort
 Object.keys(tempObj).sort((a,b) => tempObj[b]-tempObj[a]).slice(0, 18).reverse().forEach((symbol) => {  	//  descending sort
 
 //Object.keys(tempObj).sort((a,b) => tempObj[b]-tempObj[a]).reverse().forEach((symbol) => {  	//  descending sort
var temp={}
if(symbol !='NIFTY 50' && symbol !='NIFTY BANK')
//if(symbol !='NIFTY BANK')
{
	temp["label"]=symbol.replace(/NIFTY /g,'')
}
else{
	temp["label"]=symbol
}
	

		temp["y"]= Math.abs( tempObj[symbol]); 
		//temp["y"]= Math.abs( returnedDataObj[symbol]["pChange"]); 
		//var pchange = tempObj[symbol]["spike"]
		var pchange = returnedDataObj[symbol]["pChange"]
		if( pchange <0) 
		{
			temp["color"]="#cd5652"
		}
		else if( pchange>0) 
		{
			temp["color"]="#3a7dd4"
		}
		else if( pchange==0 ) 
		{
			//temp["color"]="black"
			temp["color"]="#3a7dd4"
		}
		
		dataPointsArray.push(temp)
	});
	
	
	*/

let keys = Object.keys(tempObj).sort((a, b) => tempObj[b] - tempObj[a]);

// Check if "sector" is in any key
if ( tableContainerID.includes("sector")) {
    //keys = keys.slice(0, 18); // only slice if no "sector"
		
	keys.reverse().forEach((symbol) => {   // descending sort
		var temp = {};
		if (symbol !== 'NIFTY 50' && symbol !== 'NIFTY BANK') {
			temp["label"] = symbol.replace(/NIFTY /g, '');
		} else {
			temp["label"] = symbol;
		}

		temp["y"] = Math.abs(tempObj[symbol]);
		var pchange = returnedDataObj[symbol]["pChange"];
		var positive_price_spikes = returnedDataObj[symbol]["positive_price_spikes"];
		var negative_price_spikes = returnedDataObj[symbol]["negative_price_spikes"];
		
		if( pchange >= 0 )
		{
			var positiv_negative_percentage =( positive_price_spikes / ( positive_price_spikes + negative_price_spikes ) )*100
			//temp["label"] = positive_price_spikes +'/'+ ( positive_price_spikes + negative_price_spikes ) +' '+ temp["label"]
			//temp["label"] = positiv_negative_percentage.toFixed(2) +' '+ temp["label"]
			temp["positiv_negative_percentage"] = positiv_negative_percentage.toFixed(2) +' ('+ positive_price_spikes +'/'+ ( positive_price_spikes + negative_price_spikes ) +')'
		}
		else
		{
			var positiv_negative_percentage =( negative_price_spikes / ( positive_price_spikes + negative_price_spikes ) )*100
			//temp["label"] = negative_price_spikes +'/'+ ( positive_price_spikes + negative_price_spikes ) +' '+ temp["label"]
			//temp["label"] = positiv_negative_percentage.toFixed(2) +' '+ temp["label"]
			temp["positiv_negative_percentage"] = positiv_negative_percentage.toFixed(2) +' ('+ negative_price_spikes +'/'+ ( positive_price_spikes + negative_price_spikes ) +')'
		}
		
		if (pchange < 0) {
			temp["color"] = "#cd5652";
		} else if (pchange > 0) {
			temp["color"] = "#3a7dd4";
		} else {
			temp["color"] = "#3a7dd4";
		}

		dataPointsArray.push(temp);
	});
	
}
else
{
   keys = keys.slice(0, 18); // only slice if no "sector"
		
	keys.reverse().forEach((symbol) => {   // descending sort
		var temp = {};
		if (symbol !== 'NIFTY 50' && symbol !== 'NIFTY BANK') {
			temp["label"] = symbol.replace(/NIFTY /g, '');
		} else {
			temp["label"] = symbol;
		}

		temp["y"] = Math.abs(tempObj[symbol]);
		var pchange = returnedDataObj[symbol]["pChange"];

		if (pchange < 0) {
			temp["color"] = "#cd5652";
		} else if (pchange > 0) {
			temp["color"] = "#3a7dd4";
		} else {
			temp["color"] = "#3a7dd4";
		}

		dataPointsArray.push(temp);
	});
}

// this section is for plotting indices chart for simple perchange change of single column bar
var chart = new CanvasJS.Chart(tableContainerID, {
	animationEnabled: false,
	theme: "dark2", // "light1", "light2", "dark1", "dark2"
	title: {
		//text: "GDP Growth Rate - 2016"
	},
	subtitles: [{
			//text: "Subtitle 1"
		  },{
			text:  tableCaption+' | '+selectedTradingDate +' | '+previousTimeValue +'-'+currentTimeValue,
			//verticalAlign: "top",

			 //horizontalAlign: "right",
	
			 //fontSize: 15,
			 fontSize: 13,
			//dockInsidePlotArea: true
			dockInsidePlotArea: false
	}],
	
	toolTip: {
			//fontSize: 19,
			fontSize: 15,
	},
	axisY: {
		//title: "Growth Rate (in %)",
		//includeZero: true,
		//suffix: "%",
		gridThickness: 0.1,
		//labelFontSize: 18,
		labelFontSize: 11, // bottom size for change%
	},
	axisX: {
		interval: 1,
		//title: "Countries"
		includeZero: true,
		 //labelFontSize: 17,
		 labelFontSize: 13, // vertical axis size for text
		 //labelFontWeight: "bold",
		 lineThickness: 0,
		 tickLength: 0,
	},
	dataPointWidth: 10,
	data: [{
		//indexLabel: "{y}",
		//indexLabel: "{ x }",
		indexLabel: "{ positiv_negative_percentage }",
		indexLabelFontSize: 13,
		click: onClick,
		//type: "column",
		type: "bar",
		yValueFormatString: "#,##0.0#\"%\"",
		dataPoints: dataPointsArray
	}]
});


console.log("dataPointsArray",dataPointsArray)
chart.render();
//chart2.render();

} // showIndicesPerformanceChart ENDS HERE


function onClick(e) {

		//var label=e.dataPoint.label
		//var label=e.dataPoint.label.replace(/ \(.*/g, '')
		var label=e.dataPoint.label.replace(/^.*? /, '').replace(/ \(.*/g, '')
		var labelToScroll;
		{
		
				labelToScroll = label
				
				document.getElementById("tableListSelector").value = labelToScroll ;
				getEquityDataForSectorStocks();
				document.getElementById("tableListSelector").scrollIntoView();
			/*
			if( label=='NIFTY 50' || label=='NIFTY BANK')
			{
				
				labelToScroll = label.replace(/ /g, '_')
				
				document.getElementById("tableListSelector").value = labelToScroll ;
				getEquityDataForSectorStocks();
				document.getElementById("tableListSelector").scrollIntoView();
			}
			else
			{
				labelToScroll = 'NIFTY_'+label.replace(/ /g, '_')
				
				document.getElementById("tableListSelector").value = labelToScroll ;
				getEquityDataForSectorStocks();
				document.getElementById("tableListSelector").scrollIntoView();
			}
			*/
		}

		
}


function add_Sectors_In_HeatMapSelector( )
{
	//console.log( "sectorStockNamesObj", sectorStockNamesObj)
	
	if( sectorStockNamesObj !=undefined)
	{
	if( document.getElementById("tableListSelector").getElementsByTagName('option').length <=1 )
	{
	//document.getElementById("heatMapSectorSelector").innerHTML = "";
	document.getElementById("tableListSelector").innerHTML = "";
	
	var option = document.createElement("option");
	option.value = "ALL BANKS";
	option.text = "ALL BANKS";
	//document.getElementById("heatMapSectorSelector").add(option);
	
	
	
	for ( var sectorName in sectorStockNamesObj ) {
		
		if( sectorName != 'Template' )
		{
		var option = document.createElement("option");
		option.value = sectorName;
		option.text = sectorName;
		//document.getElementById("heatMapSectorSelector").add(option);
		
		var option = document.createElement("option");
		option.value = sectorName;
		option.text = sectorName;	
		document.getElementById("tableListSelector").add(option);
		}
	}
	//document.getElementById('heatMapSectorSelector').value=document.getElementById('heatMapSectorSelector').getElementsByTagName('option')[2].value
	//document.getElementById('heatMapSectorSelector').value="NIFTY_50"
	document.getElementById('tableListSelector').value="FnO"
	}
	
	//showHeatMapChart(sectorStockNamesObj)
	//showHeatMapChart()
	}
	
} // add_Sectors_In_HeatMapSelector() ENDS HERE


async function getEquityDataForSectorStocks()
{
	var selectedMonthYear = document.getElementById('monthYear').value
	var selectedTradingDate = document.getElementById('tradingDate').value
	var selectedTimeValueRef = document.getElementById('equityTimeValues')
	var selectedMarketTypeValue = document.getElementById('marketType').value
	
	var selectedTimeValue = selectedTimeValueRef.value
	
	var docPathForDeliveryData = '/'+selectedMonthYear+'/'+selectedTradingDate+'/delivery_data/delivery_data'
	//var docPathForDeliveryData = '/'+selectedMonthYear+'/'+selectedTradingDate+'/delivery_data'
	var deliveryDataObj = await fetchDeliveryDataDocData( docPathForDeliveryData )
	
	var docPathForEquity = '/'+selectedMonthYear+'/'+selectedTradingDate+'/equity_market/'+selectedMarketTypeValue+'/'+selectedTimeValue+'/'+selectedTimeValue
	var equityDataObj = JSON.parse( (await fetchFirebaseDocData( docPathForEquity ) ) ['data'] )

	var collectioPath = '/'+selectedMonthYear+'/'+selectedTradingDate+'/'
	var calculatedEODDeliveryDataObj = await fetchCalculatedEODDeliveryData( collectioPath )
	

	var timeValuePrev5minutes = ''
	var equityDataObjPrev5m = {}
	if( selectedTimeValueRef.options[selectedTimeValueRef.selectedIndex - 3] !=undefined )
	{
	var tableContainerID = 'spike5mTableContainer_sectorStocks'
	var tableID = 'spike5mTable_sectorStocks'
	var tableCaption = '5 Minutes Spike'
	timeValuePrev5minutes = selectedTimeValueRef.options[selectedTimeValueRef.selectedIndex - 3].value
		var docPathForEquityPrev5m = '/'+selectedMonthYear+'/'+selectedTradingDate+'/equity_market/'+selectedMarketTypeValue+'/'+timeValuePrev5minutes+'/'+timeValuePrev5minutes
	
	equityDataObjPrev5m =  JSON.parse( (await fetchFirebaseDocData( docPathForEquityPrev5m ) ) ['data'] )
	console.log( "equityDataObj", equityDataObj)
		//console.log( "equityDataObjPrev5m", equityDataObjPrev5m)
	//show_momentum_spike_Data( tableCaption, tableContainerID, tableID, selectedTimeValue, timeValuePrev5minutes, equityDataObj, equityDataObjPrev5m, JSON.parse( deliveryDataObj['data'] ), selectedTradingDate)
	
	//show_sector_momentum_spike_Data( tableCaption, tableContainerID, tableID, selectedTimeValue, timeValuePrev5minutes, equityDataObj, equityDataObjPrev5m, JSON.parse( deliveryDataObj['data'] ), selectedTradingDate)
	show_sector_stocks_momentum_spike_Data( tableCaption, tableContainerID, tableID, selectedTimeValue, timeValuePrev5minutes, equityDataObj, equityDataObjPrev5m, JSON.parse( deliveryDataObj['data'] ), selectedTradingDate, calculatedEODDeliveryDataObj )
	
	}
	
	
	var timeValuePrev10minutes = ''
	var equityDataObjPrev10m = {}
	if( selectedTimeValueRef.options[selectedTimeValueRef.selectedIndex - 5] !=undefined )
		{
		var tableContainerID = 'spike10mTableContainer_sectorStocks'
		var tableID = 'spike10mTable_sectorStocks'
		var tableCaption = '10 Minutes Spike'
		timeValuePrev10minutes = selectedTimeValueRef.options[selectedTimeValueRef.selectedIndex - 5].value
		var docPathForEquityPrev10m = '/'+selectedMonthYear+'/'+selectedTradingDate+'/equity_market/'+selectedMarketTypeValue+'/'+timeValuePrev10minutes+'/'+timeValuePrev10minutes

		equityDataObjPrev10m =  JSON.parse(  ( await fetchFirebaseDocData( docPathForEquityPrev10m ) )['data'] )
		
		show_sector_stocks_momentum_spike_Data( tableCaption, tableContainerID, tableID, selectedTimeValue, timeValuePrev10minutes, equityDataObj, equityDataObjPrev10m, JSON.parse( deliveryDataObj['data'] ), selectedTradingDate, calculatedEODDeliveryDataObj)
		}


	var timeValuePrev15minutes = ''
	var equityDataObjPrev15m = {}
	if( selectedTimeValueRef.options[selectedTimeValueRef.selectedIndex - 8] !=undefined )
	{
	var tableContainerID = 'spike15mTableContainer_sectorStocks'
	var tableID = 'spike15mTable_sectorStocks'
	var tableCaption = '15 Minutes Spike'
	timeValuePrev15minutes = selectedTimeValueRef.options[selectedTimeValueRef.selectedIndex - 8].value
		var docPathForEquityPrev15m = '/'+selectedMonthYear+'/'+selectedTradingDate+'/equity_market/'+selectedMarketTypeValue+'/'+timeValuePrev15minutes+'/'+timeValuePrev15minutes
	
	equityDataObjPrev15m = JSON.parse( (await fetchFirebaseDocData( docPathForEquityPrev15m ) ) ['data'] )
	//equityDataObjPrev15m = JSON.parse( await fetchFirebaseDocData( docPathForEquityPrev15m ) )['data'] 
	show_sector_stocks_momentum_spike_Data( tableCaption, tableContainerID, tableID, selectedTimeValue, timeValuePrev15minutes, equityDataObj, equityDataObjPrev15m, JSON.parse( deliveryDataObj['data'] ), selectedTradingDate, calculatedEODDeliveryDataObj)
	}
	
		
	//addEventListnerInTables()
	
	
}


async function show_sector_stocks_momentum_spike_Data( tableCaption, tableContainerID, tableID, currentTimeValue, previousTimeValue, currentEquityDataObj, previousEquityDataObj, deliveryDataObj, selectedTradingDate, calculatedEODDeliveryDataObj )
//async function show_momentum_spike_Data( selectedSpurtsTimeValue, selectedSpurtsTimeValuePrevious, selectedTradingDate, equityDataObj, equityDataObjPrevious, spurtsDataObj, spurtsDataObjPrevious, deliveryDataObj )
{
	
	 document.getElementById(tableContainerID).innerHTML = "";
	
	var sectorStockArray = sectorStockNamesObj[ document.getElementById('tableListSelector').value ]
	//console.log("sectorStockArray",sectorStockArray)
	//console.log("deliveryDataObj",deliveryDataObj)
	
	var niftyTotalMarketObject = currentEquityDataObj['data']
	var niftyTotalMarket2MinutePreviousObject = previousEquityDataObj['data']
	console.log(niftyTotalMarketObject,niftyTotalMarket2MinutePreviousObject)
	

	var tempDataObj = {}
	  var onlyEquityTableStr = ' <div class=""> <div class="spaceBetweenTablesSpurtsEquity" style="height:550px;"> <table id="'+tableID+'"> <caption style="caption-side:top"> '+tableCaption+' | '+selectedTradingDate+' | '+previousTimeValue+'-'+currentTimeValue+'</caption> <thead> <tr class="tableRowClass">'
	+'<th>Symbol</th>'
	  +' <th>Chg%</th>'
	  +' <th>DChg%</th>'
	 // +' <th>20DAP</th>'
	  
	  +' <th>DC%Fac</th>'
	 //  +' <th>T.O.</th>'
	   
	   +' <th>P.Spike</th>'
	   +' <th>Fac</th>'
	   +' <th>High</th>'
	   +' <th>Low</th>'
	   
	   +' <th>P.Spike</th>'
	   +' <th>V.Spike</th>'
	   +' <th>PV.Spike</th>'
	   
	 //+' <th>Money</th>'
	  +' <th>20DAV</th>'
	  
	  +' <th>DQ</th>'
	  +' <th>D%</th>'
	  +' <th>Rng</th>'
	  +' </tr> </thead> <tbody>'

		//for (var S=0; S<spurtsInOIUnderlyingsObject.length ;S++ ) { // loop for accessing all stocks of 754 stocks
		//var Symbol=spurtsInOIUnderlyingsObject[S]['symbol']
		//for (var Symbol in niftyTotalMarketObject ) { // loop for accessing all stocks of 754 stocks
		for (var Symbol of sectorStockArray ) { // loop for accessing all stocks of 754 stocks
		if( Symbol.includes('NIFTY')==false && Symbol !='NIFTY TOTAL MARKET' && deliveryDataObj["Symbols"][Symbol]!=undefined )
		{
		
		var symbolArray = niftyTotalMarketObject[Symbol] //for short-handing
		var previousSymbolArray = niftyTotalMarket2MinutePreviousObject [Symbol]  
		if( symbolArray !=undefined && previousSymbolArray !=undefined )
		{
		


	  	   var valueSpike = Math.abs ( ( ( symbolArray['totalTradedValue'] -  previousSymbolArray['totalTradedValue']) / previousSymbolArray['totalTradedValue'] ) * 100).toFixed(2)
	   var priceSpike =  ( ( ( symbolArray['lastPrice'] -  previousSymbolArray['lastPrice']) / previousSymbolArray['lastPrice'] ) * 100).toFixed(2)
	   var priceValueSpike = Math.abs( valueSpike * priceSpike ).toFixed(2)
	   //var valueSpike = Math.abs(  priceSpike ).toFixed(2)

	 var DayOpen = symbolArray['open'] 
	 var DayHigh = symbolArray['dayHigh'] 
	 var DayLow = symbolArray['dayLow'] 
	 var LastPrice = symbolArray['lastPrice'] 
	
	var DayChangePercentage =( ( (LastPrice - DayOpen) / DayOpen) *100).toFixed(2)
	  
	  var DayRange =( ( (DayHigh - DayLow) / DayLow) *100).toFixed(2)
	  
    var near_high_pct = (1 - (DayHigh - LastPrice) / (DayHigh - DayLow)) * 100 
    var near_low_pct = (1 - (LastPrice - DayLow) / (DayHigh - DayLow)) * 100
	
	  
	  
	var average20DaysValue = deliveryDataObj["Symbols"][Symbol]["calculatedData"]["averageValues"]["twentyDays"]

	var twentyDAV =( symbolArray["totalTradedValue"]  / average20DaysValue).toFixed(2)
	 		 /*
			 tempDataObj[Symbol] ={
			  "spike":valueSpike,
			  "pChange":symbolArray['pChange']
			  }
			  */
			  
	 		  tempDataObj[Symbol] ={
			 // "spike":valueSpike,
			  "spike":Math.abs ( priceSpike ),
			  "twentyDAV":twentyDAV,
			  //"pChange":symbolArray['pChange'],
			  "pChange":priceSpike,
			  //symbolArray
			  }

			  
		{
			onlyEquityTableStr +='<tr class="item"><td>'
			 +Symbol
			 +'</td><td>'
			+ symbolArray['pChange']  //pchange
			 //+'</td><td>'
			// +( symbolArray['totalTradedValue'] / 1000000).toFixed(0)  //(symbolArray[8] / 10000000).toFixed(2) //totalTradedValue
			//+'</td><td>'
			 //+ valueSpike //NoMinuspChng.toFixed(2) 
			// + valueSpike //NoMinuspChng.toFixed(2) 
			 //+ priceValueSpike //NoMinuspChng.toFixed(2) 
			 
			 +'</td><td>'
			+ DayChangePercentage
			
			 +'</td><td>'
			+  Math.abs( twentyDAV * DayChangePercentage ).toFixed(2)
			
			 +'</td><td>'
			+ Math.abs ( priceSpike )
			
			 +'</td><td>'
			+ Math.abs( twentyDAV * priceSpike).toFixed(2)
			//+ Math.abs( DayRange * twentyDAV).toFixed(2)
			
			 +'</td><td>'
			+ near_high_pct.toFixed(0) 
			
			 +'</td><td>'
			+ near_low_pct.toFixed(0) 
			 
			 +'</td><td>'
			+ priceSpike
			
			 +'</td><td>'
			+ valueSpike
			
			 +'</td><td>'
			+ priceValueSpike
			 
			 +'</td><td>'
			// + WFactor
			//+'</td><td>'
			+ twentyDAV
			
			//+ Math.abs( twentyDAV * symbolArray['pChange'] ).toFixed(2)
			//+ Math.abs( twentyDAV * priceSpike ).toFixed(2)
			
			+'</td><td>'
			+ (calculatedEODDeliveryDataObj[Symbol] ? calculatedEODDeliveryDataObj[Symbol] ['averageDeliveryQuantity'] : 0)
			+'</td><td>'
			+ (calculatedEODDeliveryDataObj[Symbol] ? calculatedEODDeliveryDataObj[Symbol] ['averageDeliveryPercentage'] : 0)
			+'</td><td>'
			+DayRange
			
			+'</td></tr>'
			
		
		}
		}
	}
		} //for Loop ENDS HERE
		
		onlyEquityTableStr +=' </tbody> </table>    </div>  </div>'
		
		
if( document.getElementById('showTablesForSectorStocksOnOff').checked==true )
{ 
	document.getElementById(tableContainerID).innerHTML = onlyEquityTableStr
}
else
{
showSpikeChart( tableCaption, tableContainerID, tableID, currentTimeValue, previousTimeValue, selectedTradingDate, tempDataObj  )
}
	
	addEventListnerInTables()
}	//	show_volume_value_spike_Data() Function ENDS HERE

</script>
<!-- Indices Code Ends Here -->


<!-- Floating Buttons Code Starts Here -->
<style>		.float{	position:fixed;	width:25px;	height:50px;	bottom:16%;	right:10px;			border-radius:50px;	text-align:center;	}.vertical-centerFloat {   float: right;  margin: 0;  position: sticky;  top: 50%;  -ms-transform: translateY(-50%);  transform: translateY(-50%);	}  .Floatbtn{ margin-top:1px;} </style>
<div class="float"> 	<button class="Floatbtn" onclick="document.getElementById('commonTimeValues').scrollIntoView();"><b><span style="font-size:20px;">&#8593;</span></b></button><br/>	     <button class="Floatbtn" onclick="getFirestoreData('live','')"><b><span style="font-size:20px;">&#8883;</span></b></button>	 <button class="Floatbtn" onclick="document.getElementById('spike5mTableContainer_sectors').scrollIntoView();"><b><span style="font-size:20px;">&#8595;</span></b></button><br/></div>
<!-- Floating Buttons Code Ends Here -->


<script>
// Example usage: generate month and year from April 2023 till now
generateMonthYearFromDate( new Date("April 2023") );
</script>